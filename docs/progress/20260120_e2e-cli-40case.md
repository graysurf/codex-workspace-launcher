# codex-workspace-launcher: CLI E2E 40-case matrix

| Status | Created | Updated |
| --- | --- | --- |
| IN PROGRESS | 2026-01-20 | 2026-01-20 |

Links:

- PR: [#4](https://github.com/graysurf/codex-workspace-launcher/pull/4)
- Case source: `tests/e2e/plan.py` (`plan_cases("cli")`)
- Test entry: `tests/e2e/test_cws_cli_cases.py`
- Artifacts: `out/tests/e2e/` (per-case `meta.json`, `stdout.txt`, `stderr.txt`, plus `summary.jsonl`)

## Rules / Workflow

Goal: Run all 40 CLI plan cases **one-by-one**, record PASS/FAIL/SKIP, then rerun + fix until all intended cases PASS.

### 0) Pre-flight

- Docker must be running: `docker info >/dev/null`
- Always run via pytest (so logs/evidence are written consistently).

### 1) Run command (single case)

Template:

```sh
CWS_E2E=1 \
  CWS_E2E_CASE=<case_id> \
  .venv/bin/python -m pytest -m e2e tests/e2e/test_cws_cli_cases.py
```

Common extra env (case-dependent):

- Public repo (required for most `create`/all `reset`/`exec_command`): `CWS_E2E_PUBLIC_REPO=OWNER/REPO`
- Private repo: `CWS_E2E_PRIVATE_REPO=OWNER/PRIVATE_REPO` (and working GitHub auth)
- Auth cases: `CWS_E2E_ENABLE_AUTH=1`
- Codex auth case: `CWS_E2E_ENABLE_CODEX=1 CWS_E2E_CODEX_PROFILE=<profile>`
- GPG auth case: `CWS_E2E_ENABLE_GPG=1 CWS_E2E_GPG_KEY_ID=<keyid>`
- SSH create cases: `CWS_E2E_ENABLE_SSH=1` (and usable SSH credentials)
- Tunnel cases: `CWS_E2E_ENABLE_TUNNEL=1`
- Exec shell case: `CWS_E2E_ENABLE_EXEC_SHELL=1`
- Dangerous `rm --all`: `CWS_E2E_ALLOW_RM_ALL=1` (read the warning below)

Optional (use with caution):

- Use host HOME/XDG (so the launcher can see your real `~/.ssh`, `~/.config`, `~/.gnupg`, etc): `CWS_E2E_USE_HOST_HOME=1`
- Keep created workspaces for debugging: `CWS_E2E_KEEP_WORKSPACES=1`

### 2) Record results (Round 1 / Round 2)

For each case run:

1. Update the table row:
   - `R1` or `R2`: `PASS` / `FAIL` / `SKIP (<reason>)`
   - `Updated`: copy `generated_at` from `meta.json`
2. Evidence is always written here:
   - `out/tests/e2e/cli/<case_id>/meta.json`
   - `out/tests/e2e/cli/<case_id>/stdout.txt`
   - `out/tests/e2e/cli/<case_id>/stderr.txt`
3. If `FAIL`, include a short note and keep the evidence paths intact.

Note: `meta.json` is overwritten on each rerun; `out/tests/e2e/summary.jsonl` keeps an append-only history.

### 3) Safety notes (important)

- The e2e runner serializes all Docker runs using a lock under `out/tests/e2e/.lock` to avoid accidental parallelism.
- `rm_all_yes` is destructive: it removes *all* workspaces on your host that match the upstream workspace labels.
  - Only run it when you’re sure it won’t delete anything important (or use a dedicated Docker context/host).

## Case Matrix

Legend:

- Gates: env vars you must set (otherwise pytest will skip, or the case will likely fail).
- R1/R2: fill in `PASS` / `FAIL` / `SKIP (<reason>)`.

### Help / usage (8)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | help | `--help` | — | PASS | — | 2026-01-20T22:17:18+0800 | `out/tests/e2e/cli/help/meta.json` |
| 2 | help_auth | `auth --help` | — | SKIP (needs `CWS_E2E_ENABLE_AUTH=1`) | PASS | 2026-01-20T22:18:21+0800 | `out/tests/e2e/cli/help_auth/meta.json` |
| 3 | help_create | `create --help` | — | PASS | — | 2026-01-20T22:18:02+0800 | `out/tests/e2e/cli/help_create/meta.json` |
| 4 | help_ls | `ls --help` | — | PASS | — | 2026-01-20T22:19:21+0800 | `out/tests/e2e/cli/help_ls/meta.json` |
| 5 | help_exec | `exec --help` | — | SKIP (needs `CWS_E2E_ENABLE_EXEC_SHELL=1`) | PASS | 2026-01-20T22:19:43+0800 | `out/tests/e2e/cli/help_exec/meta.json` |
| 6 | help_rm | `rm --help` | — | PASS | — | 2026-01-20T22:19:53+0800 | `out/tests/e2e/cli/help_rm/meta.json` |
| 7 | help_reset | `reset --help` | — | SKIP (needs `CWS_E2E_PUBLIC_REPO`) | PASS | 2026-01-20T22:20:30+0800 | `out/tests/e2e/cli/help_reset/meta.json` |
| 8 | help_tunnel | `tunnel --help` | — | SKIP (needs `CWS_E2E_ENABLE_TUNNEL=1`) | PASS | 2026-01-20T22:20:56+0800 | `out/tests/e2e/cli/help_tunnel/meta.json` |

### Create (9)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 9 | create_public_owner_repo | `create OWNER/REPO` | `CWS_E2E_PUBLIC_REPO` | PASS | — | 2026-01-20T22:22:31+0800 | `out/tests/e2e/cli/create_public_owner_repo/meta.json` |
| 10 | create_public_https | `create https://github.com/OWNER/REPO` | `CWS_E2E_PUBLIC_REPO` | PASS | — | 2026-01-20T22:23:01+0800 | `out/tests/e2e/cli/create_public_https/meta.json` |
| 11 | create_public_https_git_suffix | `create https://github.com/OWNER/REPO.git` | `CWS_E2E_PUBLIC_REPO` | PASS | — | 2026-01-20T22:23:25+0800 | `out/tests/e2e/cli/create_public_https_git_suffix/meta.json` |
| 12 | create_public_ssh_scp_style | `create git@github.com:OWNER/REPO.git` | `CWS_E2E_PUBLIC_REPO`, `CWS_E2E_ENABLE_SSH` | TODO | — | — | `out/tests/e2e/cli/create_public_ssh_scp_style/meta.json` |
| 13 | create_public_ssh_url_style | `create ssh://git@github.com/OWNER/REPO.git` | `CWS_E2E_PUBLIC_REPO`, `CWS_E2E_ENABLE_SSH` | TODO | — | — | `out/tests/e2e/cli/create_public_ssh_url_style/meta.json` |
| 14 | create_no_extras | `create --no-extras OWNER/REPO` | `CWS_E2E_PUBLIC_REPO` | PASS | — | 2026-01-20T22:23:52+0800 | `out/tests/e2e/cli/create_no_extras/meta.json` |
| 15 | create_seed_private_repo | `create --private-repo OWNER/PRIVATE_REPO OWNER/REPO` | `CWS_E2E_PUBLIC_REPO`, `CWS_E2E_PRIVATE_REPO` | TODO | — | — | `out/tests/e2e/cli/create_seed_private_repo/meta.json` |
| 16 | create_no_work_repos_with_name | `create --no-work-repos --name ws-e2e` | — | PASS | — | 2026-01-20T22:22:00+0800 | `out/tests/e2e/cli/create_no_work_repos_with_name/meta.json` |
| 17 | create_multiple_repos | `create OWNER/REPO OWNER/REPO` | `CWS_E2E_PUBLIC_REPO` | TODO | — | — | `out/tests/e2e/cli/create_multiple_repos/meta.json` |

### List (1)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 18 | ls | `ls` | — | PASS | — | 2026-01-20T22:21:35+0800 | `out/tests/e2e/cli/ls/meta.json` |

### Exec (4)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 19 | exec_command | `exec ws-e2e git -C REPO_PATH status` | `CWS_E2E_PUBLIC_REPO` | PASS | — | 2026-01-20T22:25:24+0800 | `out/tests/e2e/cli/exec_command/meta.json` |
| 20 | exec_shell | `exec ws-e2e` | `CWS_E2E_ENABLE_EXEC_SHELL` | TODO | — | — | `out/tests/e2e/cli/exec_shell/meta.json` |
| 21 | exec_root | `exec --root ws-e2e id -u` | — | PASS | — | 2026-01-20T22:24:42+0800 | `out/tests/e2e/cli/exec_root/meta.json` |
| 22 | exec_user | `exec --user codex ws-e2e id -u` | — | PASS | — | 2026-01-20T22:25:01+0800 | `out/tests/e2e/cli/exec_user/meta.json` |

### Auth (4)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 23 | auth_github | `auth github ws-e2e` | `CWS_E2E_ENABLE_AUTH` | TODO | — | — | `out/tests/e2e/cli/auth_github/meta.json` |
| 24 | auth_github_host | `auth github --host github.com ws-e2e` | `CWS_E2E_ENABLE_AUTH` | TODO | — | — | `out/tests/e2e/cli/auth_github_host/meta.json` |
| 25 | auth_codex_profile | `auth codex --profile CODEX_PROFILE ws-e2e` | `CWS_E2E_ENABLE_AUTH`, `CWS_E2E_ENABLE_CODEX`, `CWS_E2E_CODEX_PROFILE` | TODO | — | — | `out/tests/e2e/cli/auth_codex_profile/meta.json` |
| 26 | auth_gpg_key | `auth gpg --key GPG_KEY_ID ws-e2e` | `CWS_E2E_ENABLE_AUTH`, `CWS_E2E_ENABLE_GPG`, `CWS_E2E_GPG_KEY_ID` | TODO | — | — | `out/tests/e2e/cli/auth_gpg_key/meta.json` |

### Reset (4)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 27 | reset_repo | `reset repo ws-e2e REPO_PATH --yes` | `CWS_E2E_PUBLIC_REPO` | TODO | — | — | `out/tests/e2e/cli/reset_repo/meta.json` |
| 28 | reset_work_repos | `reset work-repos ws-e2e --yes` | `CWS_E2E_PUBLIC_REPO` | TODO | — | — | `out/tests/e2e/cli/reset_work_repos/meta.json` |
| 29 | reset_opt_repos | `reset opt-repos ws-e2e --yes` | `CWS_E2E_PUBLIC_REPO` | TODO | — | — | `out/tests/e2e/cli/reset_opt_repos/meta.json` |
| 30 | reset_private_repo | `reset private-repo ws-e2e --yes` | `CWS_E2E_PUBLIC_REPO`, `CWS_E2E_PRIVATE_REPO` | TODO | — | — | `out/tests/e2e/cli/reset_private_repo/meta.json` |

### Tunnel (3)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 31 | tunnel_foreground | `tunnel ws-e2e` | `CWS_E2E_ENABLE_TUNNEL` | TODO | — | — | `out/tests/e2e/cli/tunnel_foreground/meta.json` |
| 32 | tunnel_detach | `tunnel ws-e2e --detach` | `CWS_E2E_ENABLE_TUNNEL` | TODO | — | — | `out/tests/e2e/cli/tunnel_detach/meta.json` |
| 33 | tunnel_named | `tunnel ws-e2e --name ws-e2e-tunnel` | `CWS_E2E_ENABLE_TUNNEL` | TODO | — | — | `out/tests/e2e/cli/tunnel_named/meta.json` |

### Remove (2)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 34 | rm_workspace_yes | `rm ws-e2e --yes` | — | PASS | — | 2026-01-20T22:26:31+0800 | `out/tests/e2e/cli/rm_workspace_yes/meta.json` |
| 35 | rm_all_yes | `rm --all --yes` | `CWS_E2E_ALLOW_RM_ALL` | TODO | — | — | `out/tests/e2e/cli/rm_all_yes/meta.json` |

### Env / config (5)

| # | case_id | args (template) | Gates | R1 | R2 | Updated | Evidence |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 36 | env_custom_image | `ls` (env: `CWS_IMAGE=graysurf/codex-workspace-launcher:latest`) | — | TODO | — | — | `out/tests/e2e/cli/env_custom_image/meta.json` |
| 37 | env_auth_env | `ls` (env: `CWS_AUTH=env`) | — | TODO | — | — | `out/tests/e2e/cli/env_auth_env/meta.json` |
| 38 | env_auth_none | `ls` (env: `CWS_AUTH=none`) | — | PASS | — | 2026-01-20T22:26:44+0800 | `out/tests/e2e/cli/env_auth_none/meta.json` |
| 39 | env_docker_args_string | `ls` (env: `CWS_DOCKER_ARGS="-e FOO=bar -e BAZ=qux"`) | — | PASS | — | 2026-01-20T22:27:03+0800 | `out/tests/e2e/cli/env_docker_args_string/meta.json` |
| 40 | env_cws_bash_path | `ls` (env: `CWS_BASH_PATH=scripts/cws.bash`) | — | PASS | — | 2026-01-20T22:27:24+0800 | `out/tests/e2e/cli/env_cws_bash_path/meta.json` |
