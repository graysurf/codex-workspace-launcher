{
  "smoke": [
    {
      "name": "help",
      "command": ["bash", "scripts/release_audit.sh", "--help"],
      "timeout_sec": 10,
      "expect": {
        "exit_codes": [0],
        "stderr_regex": "(?s)usage:.*scripts/release_audit\\.sh"
      }
    },
    {
      "name": "audit_minimal_repo_passes",
      "command": [
        "bash",
        "-c",
        "set -euo pipefail; repo=$(pwd); tmp=$(mktemp -d 2>/dev/null || true); if [[ -z \"${tmp:-}\" ]]; then tmp=\"/tmp/cws-smoke.release_audit.$$\"; mkdir -p -- \"$tmp\"; fi; cleanup(){ rm -rf -- \"$tmp\" >/dev/null 2>&1 || true; }; trap cleanup EXIT; cd \"$tmp\"; git init -q; printf '%s\\n' 'ZSH_KIT_REF=1111111111111111111111111111111111111111' 'CODEX_KIT_REF=2222222222222222222222222222222222222222' >VERSIONS.env; printf '%s\\n' '# Changelog' '' '## v1.2.3 - 2026-01-02' '' '### Upstream pins' '- zsh-kit: 1111111111111111111111111111111111111111' '- codex-kit: 2222222222222222222222222222222222222222' '' '### Changes' '- Smoke coverage' '' '## v1.2.2 - 2026-01-01' '' '- Older thing' '' >CHANGELOG.md; git add CHANGELOG.md VERSIONS.env; GIT_AUTHOR_NAME=smoke GIT_AUTHOR_EMAIL=smoke@example.com GIT_COMMITTER_NAME=smoke GIT_COMMITTER_EMAIL=smoke@example.com git commit -qm init; PATH=\"/usr/bin:/bin:/usr/sbin:/sbin\" bash \"$repo/scripts/release_audit.sh\" --version v1.2.3 >/dev/null; echo OK"
      ],
      "timeout_sec": 10,
      "expect": {
        "exit_codes": [0],
        "stdout_regex": "(?m)^OK$"
      }
    }
  ]
}
