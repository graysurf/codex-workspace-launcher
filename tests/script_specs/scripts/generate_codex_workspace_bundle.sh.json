{
  "smoke": [
    {
      "name": "help",
      "command": ["bash", "scripts/generate_codex_workspace_bundle.sh", "--help"],
      "timeout_sec": 10,
      "expect": {
        "exit_codes": [0],
        "stdout_regex": "(?s)usage:.*scripts/generate_codex_workspace_bundle\\.sh"
      }
    },
    {
      "name": "bundle_local_zsh_kit_repo",
      "command": [
        "bash",
        "-c",
        "set -euo pipefail; tmp=$(mktemp -d 2>/dev/null || true); if [[ -z \"${tmp:-}\" ]]; then tmp=\"/tmp/cws-smoke.bundle.$$\"; mkdir -p -- \"$tmp\"; fi; cleanup(){ rm -rf -- \"$tmp\" >/dev/null 2>&1 || true; }; trap cleanup EXIT; zsh_repo=\"$tmp/zsh-kit\"; launcher=\"$tmp/launcher\"; mkdir -p -- \"$zsh_repo/tools\" \"$zsh_repo/scripts/_features/codex-workspace\" \"$launcher/scripts/bundles\" \"$launcher/bin\"; printf '%s\\n' '#!/usr/bin/env zsh' 'set -eu' 'input=\"\"' 'output=\"\"' 'entry=\"\"' 'while [[ $# -gt 0 ]]; do' '  case \"$1\" in' '    --input) input=\"$2\"; shift 2 ;;' '    --output) output=\"$2\"; shift 2 ;;' '    --entry) entry=\"$2\"; shift 2 ;;' '    *) shift ;;' '  esac' 'done' '[[ -n \"$output\" ]] || { print -u2 -r -- \"missing --output\"; exit 2 }' 'mkdir -p -- \"$(dirname \"$output\")\"' '{' '  print -r -- \"#!/usr/bin/env zsh\"' '  print -r -- \"# Bundled from: $input\"' '  print -r -- \"# entry: $entry\"' '} >\"$output\"' >\"$zsh_repo/tools/bundle-wrapper.zsh\"; chmod +x \"$zsh_repo/tools/bundle-wrapper.zsh\"; for f in alias.zsh repo-reset.zsh workspace-rm.zsh workspace-rsync.zsh workspace-launcher.zsh; do printf '%s\\n' \"# $f\" >\"$zsh_repo/scripts/_features/codex-workspace/$f\"; done; git -C \"$zsh_repo\" init -q; git -C \"$zsh_repo\" add -A; GIT_AUTHOR_NAME=smoke GIT_AUTHOR_EMAIL=smoke@example.com GIT_COMMITTER_NAME=smoke GIT_COMMITTER_EMAIL=smoke@example.com git -C \"$zsh_repo\" commit -qm init; sha=$(git -C \"$zsh_repo\" rev-parse HEAD); cp scripts/generate_codex_workspace_bundle.sh \"$launcher/scripts/\"; cp scripts/bundles/codex-workspace.wrapper.zsh \"$launcher/scripts/bundles/\"; printf '%s\\n' \"ZSH_KIT_REF=$sha\" >\"$launcher/VERSIONS.env\"; ZSH_KIT_REPO=\"$zsh_repo\" bash \"$launcher/scripts/generate_codex_workspace_bundle.sh\"; test -x \"$launcher/bin/codex-workspace\"; grep -q \"^# Generated from: graysurf/zsh-kit@$sha$\" \"$launcher/bin/codex-workspace\"; grep -q '^# Bundled from: scripts/bundles/codex-workspace.wrapper.zsh$' \"$launcher/bin/codex-workspace\"; grep -q '^# DO NOT EDIT: regenerate via scripts/generate_codex_workspace_bundle.sh$' \"$launcher/bin/codex-workspace\"; echo OK"
      ],
      "timeout_sec": 20,
      "expect": {
        "exit_codes": [0],
        "stdout_regex": "(?m)^OK$"
      }
    }
  ]
}
