#!/usr/bin/env bash
set -euo pipefail

script_dir="$(
  cd -- "$(dirname -- "${BASH_SOURCE[0]}")" >/dev/null 2>&1
  pwd -P
)"

cws_bash_path="${CWS_BASH_PATH:-${script_dir}/cws.bash}"
if [[ ! -f "$cws_bash_path" ]]; then
  config_home="${XDG_CONFIG_HOME:-${HOME:-}}"
  if [[ -n "$config_home" ]]; then
    cws_bash_path="${config_home%/}/codex-workspace-launcher/cws.bash"
  fi
fi

if [[ -f "$cws_bash_path" ]]; then
  exec bash "$cws_bash_path" "$@"
fi

cat >&2 <<'EOF'
error: cannot find cws.bash

Tried:
- ./scripts/cws.bash (next to this script)
- ${XDG_CONFIG_HOME:-$HOME/.config}/codex-workspace-launcher/cws.bash
- $CWS_BASH_PATH

Install (bash):
  mkdir -p "$HOME/.config/codex-workspace-launcher"
  curl -fsSL https://raw.githubusercontent.com/graysurf/codex-workspace-launcher/main/scripts/cws.bash \
    -o "$HOME/.config/codex-workspace-launcher/cws.bash"
  source "$HOME/.config/codex-workspace-launcher/cws.bash"
EOF
exit 1
